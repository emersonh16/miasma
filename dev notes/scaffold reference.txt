Perfect, thanks for linking the scaffold doc âœ…

Iâ€™ll update it with the new **rocks pipeline** (rockfield â†’ gridgen â†’ rocks) so it matches the refactor we just did.

---

# Derelict Drifters â€” Scaffold Reference (updated)

âœ… Current Structure

```
index.html
core/
  game.js        // main loop, reset, input, system wiring
  config.js      // all tunables + feature flags
engine/
  eventbus.js    // emit / on system
  input.js       // keysDown + wasPressed
  streamer.js    // mounts/unmounts chunks around camera
  chunk.js       // math helpers (worldâ†’chunk, keys, origins)
  chunkreg.js    // listens to mount/unmount, keeps Set of active chunks
  rng.js         // deterministic rand01(seed, cx, cy, salt)
  diffstore.js   // per-chunk persistent memory (rocks broken, loot, etc.)
  rockfield.js   // global nuclei â†’ grow big blobs once, cached
  gridgen.js     // per-chunk 0/1 grid â†’ samples blobsForChunk
systems/
  player.js      // player is always center; moves camera with WASD
  world.js       // draws mounted chunks (checkerboard), tracks visited
  rocks.js       // manages rock grids per chunk, draws rocks, isSolid()
ui/
  devhud.js      // debug HUD (top-right): FPS, mounted, remembered
docs/
  scaffold.md    // (this doc)
```

---

ğŸ”‘ Key Ideas

* **Player** locked to screen center â†’ camera moves world instead.
* **Streamer** = stagehands â†’ decides which chunks are â€œon stageâ€ now.
* **ChunkReg** = registry â†’ keeps live list of mounted chunks.
* **World** = paint crew â†’ just draws what registry says exists.
* **DiffStore** = memory â†’ stores changes that must persist (e.g. rocks smashed).
* **DevHUD** = directorâ€™s monitor â†’ shows FPS + counts (top-right).
* **Reset()** = â€œCut!â€ â†’ wipes state clean and re-inits systems.
* **Rockfield** = geology â†’ picks nuclei in world space, grows blobs once, caches them.
* **Gridgen** = quarry â†’ for each mounted chunk, samples rockfield blobs into a binary grid.
* **Rocks** = props crew â†’ draws those grids, handles collisions, asks â€œisSolid(x,y)?â€.

---

ğŸ¯ Next Safe Scaffolding Steps

* **Unique visited counter**
  Count how many distinct chunks youâ€™ve ever entered. Show in DevHUD.

* **Pause toggle (P)**
  Freeze updates (but still draw) for testing/debugging.

* **Weather Bubble skeleton**
  Big circle that follows player; isInside(x,y) check. Used later for fog/weather logic (Noita-style).

* **Player HUD (top-left)**
  Health, energy, beam bars â€” leaves DevHUD for debug only.

* **Save/Load snapshot (later)**
  Seed + camera + diffstore â†’ localStorage. Keeps progress after reload.

---

ğŸ“ Definition of Done (for scaffold)

* Systems init cleanly via reset().
* Flags in config can enable/disable features.
* Events (chunk\:mount/unmount) decouple systems.
* DiffStore is generic, capped, and JSON-friendly.
* DevHUD top-right shows stable counts.
* Rockfield caches blobs; Gridgen builds per-chunk grids only once.
* No test junk left behind â€” every system behind a flag.

---

âœ… With this scaffold solid, we can safely add fun systems:

* **Rocks** (persistent, saved in DiffStore)
* **Miasma** (dynamic bubble, no saving per chunk)
* **Enemies** (spawned per chunk, leashed, saved only if â€œdeadâ€)
* **Pickups, weapons, weather, etc.**

---

ğŸ‘‰ Do you want me to actually **overwrite your `docs/scaffold.md`** with this updated version so itâ€™s already synced in your repo, or would you prefer to paste it in yourself?
