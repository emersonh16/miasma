Derelict Drifters â€” Scaffold Reference
âœ… Current Structure
index.html
core/
  game.js        // main loop, reset, input, system wiring
  config.js      // all tunables + feature flags
engine/
  eventbus.js    // emit / on system
  input.js       // keysDown + wasPressed
  streamer.js    // mounts/unmounts chunks around camera
  chunk.js       // math helpers (worldâ†’chunk, keys, origins)
  chunkreg.js    // listens to mount/unmount, keeps Set of active chunks
  rng.js         // deterministic rand01(seed, cx, cy, salt)
  diffstore.js   // per-chunk persistent memory (rocks broken, loot, etc.)
systems/
  player.js      // player is always center; moves camera with WASD
  world.js       // draws mounted chunks (checkerboard), tracks visited
ui/
  devhud.js      // debug HUD (top-right): FPS, mounted, remembered
docs/
  scaffold.md    // (this doc)

ğŸ”‘ Key Ideas

Player locked to screen center â†’ camera moves world instead.

Streamer = stagehands â†’ decides which chunks are â€œon stageâ€ now.

ChunkReg = registry â†’ keeps live list of mounted chunks.

World = paint crew â†’ just draws what registry says exists.

DiffStore = memory â†’ stores changes that must persist (e.g. rocks smashed).

DevHUD = directorâ€™s monitor â†’ shows FPS + counts (top-right).

Reset() = â€œCut!â€ â†’ wipes state clean and re-inits systems.

ğŸ¯ Next Safe Scaffolding Steps

Unique visited counter

Count how many distinct chunks youâ€™ve ever entered.

Show in DevHUD for feedback.

Pause toggle (P)

Freeze updates (but still draw) for testing/debugging.

Weather Bubble skeleton

Big circle that follows player; isInside(x,y) check.

Used later for fog/weather logic (Noita-style).

Player HUD (top-left)

Health, energy, beam bars â€” leaves DevHUD for debug only.

Save/Load snapshot (later)

Seed + camera + diffstore â†’ localStorage.

Lets us keep progress after crashes or reloads.

ğŸ“ Definition of Done (for scaffold)

Systems init cleanly via reset().

Flags in config can enable/disable features.

Events (chunk:mount/unmount) decouple systems.

DiffStore is generic, capped, and JSON-friendly.

DevHUD top-right shows stable counts.

No test junk left behind â€” every system behind a flag.

âœ… With this scaffold solid, we can safely add fun systems:

Rocks (persistent, saved in DiffStore)

Miasma (dynamic bubble, no saving per chunk)

Enemies (spawned per chunk, leashed, saved only if â€œdeadâ€)

Pickups, weapons, weather, etc.